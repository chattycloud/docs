{"pageProps":{"frontmatter":{"title":"Non-blocking schema changes","subtitle":"Non-blocking schema changes in ChattyCloud provide a schema change workflow that allows users to update database tables without locking or causing downtime for production databases."},"headings":[{"depth":2,"value":"Overview"},{"depth":2,"value":"Adding columns to large tables with ChattyCloud is safe!"},{"depth":2,"value":"How do I make non-blocking schema changes with ChattyCloud?"},{"depth":2,"value":"ChattyCloud workflow"},{"depth":2,"value":"Limitations"},{"depth":2,"value":"Need help?"}],"body":{"compiledSource":"var d=Object.defineProperty,h=Object.defineProperties;var m=Object.getOwnPropertyDescriptors;var r=Object.getOwnPropertySymbols;var i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;var l=(e,t,o)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,a=(e,t)=>{for(var o in t||(t={}))i.call(t,o)&&l(e,o,t[o]);if(r)for(var o of r(t))s.call(t,o)&&l(e,o,t[o]);return e},p=(e,t)=>h(e,m(t));var c=(e,t)=>{var o={};for(var n in e)i.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&r)for(var n of r(e))t.indexOf(n)<0&&s.call(e,n)&&(o[n]=e[n]);return o};const makeShortcode=e=>function(o){return console.warn(\"Component \"+e+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",a({},o))},InfoBlock=makeShortcode(\"InfoBlock\"),NextBlock=makeShortcode(\"NextBlock\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var n=o,{components:e}=n,t=c(n,[\"components\"]);return mdx(MDXLayout,p(a(a({},layoutProps),t),{components:e,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"Overview\"),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},\"To make non-blocking schema changes in ChattyCloud, you'll first need a basic understanding of\",\" \",mdx(\"a\",{href:\"https://docs.chatty-cloud.com/concepts/branching\"},\"branching\"),\", the core ChattyCloud feature that provide schema changes. Our branching concepts page is a great place to start.\"),\" \",mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Non-blocking schema changes\"),\" in ChattyCloud provide a schema change workflow that allows users to update database tables without locking or causing downtime for production databases.\"),mdx(\"p\",null,\"ChattyCloud makes it safe to deploy schema changes to production databases via \",mdx(\"em\",{parentName:\"p\"},\"development\"),\" and \",mdx(\"em\",{parentName:\"p\"},\"production branches\"),\". Production (\",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\") branches cannot be deleted and can only be updated using deploy requests. Development branches are a separate database with a copy of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\" branch's schema. Developers can make schema changes in development branches, test locally, and open a deploy request for deploying their changes to the production database.\"),mdx(\"p\",null,\"Developers can also comment on deploy requests and request reviewers to approve a deploy request before its schema changes can deploy into the \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\" database branch. Currently, requiring approval is a per-database setting is turned off by default. With the setting turned off, developers do not need approval to merge a deploy request.\"),mdx(\"h2\",null,\"Adding columns to large tables with ChattyCloud is safe!\"),mdx(\"p\",null,mdx(\"em\",{parentName:\"p\"},\"Create\"),\", \",mdx(\"em\",{parentName:\"p\"},\"drop\"),\", and \",mdx(\"em\",{parentName:\"p\"},\"alter\"),\" statements, also known as Data Definition Language (DDL), are used for making schema changes in a database table.\"),mdx(\"p\",null,\"ChattyCloud enables developers to make schema changes without the fear of dropping columns, locking tables, causing downtime in their app, etc. ChattyCloud also prevents schema changes with conflicts from being migrated and handles schema changes from multiple teammates. A user doesn't have to wait to find out if their changes will be rejected, they learn as they add the change to the queue.\"),mdx(\"h2\",null,\"How do I make non-blocking schema changes with ChattyCloud?\"),mdx(\"p\",null,\"All ChattyCloud schema changes must occur on a database branch. \",mdx(\"em\",{parentName:\"p\"},\"(A database branch is a separate database with a copy of the \",mdx(\"inlineCode\",{parentName:\"em\"},\"main\"),\" branch's schema.)\")),mdx(\"p\",null,\"At a high level, this is what happens during the \",mdx(\"em\",{parentName:\"p\"},\"non-blocking schema change\"),\" process in ChattyCloud:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"You create a database branch.\"),mdx(\"li\",{parentName:\"ol\"},\"You test your changes on this branch before attempting to apply the changes to the \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\" branch. \",mdx(\"em\",{parentName:\"li\"},\"(i.e., You made some changes to the database you wish to deploy to the production database.)\")),mdx(\"li\",{parentName:\"ol\"},\"You open a request to deploy your changes to \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\".\"),mdx(\"li\",{parentName:\"ol\"},\"ChattyCloud verifies that your schema changes are safe to be deployed to production. If there are any issues or schema conflicts, you'll be shown the errors.\")),mdx(\"p\",null,\"When you hit deploy, it doesn't mean that ChattyCloud can immediately apply your schema changes to the production database. After all, there may be a current running deployment from a previous user or even from yourself. The latest deployment request automatically yields to production traffic and gets added to a deployment queue in these situations.\"),mdx(\"ol\",a({},{start:5}),mdx(\"li\",{parentName:\"ol\"},\"Your deployment makes it to the \",mdx(\"inlineCode\",{parentName:\"li\"},\"main\"),\" branch \",mdx(\"em\",{parentName:\"li\"},\"(i.e., production)\"),\", and you can now see your schema changes in the production database.\")),mdx(InfoBlock,{type:\"note\",mdxType:\"InfoBlock\"},\"ChattyCloud makes sure not to exhaust your resources; the deployment may be throttled to avoid any impact on production queries.\"),\" \",mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"/img/docs/ps_nbsc_diagram_light.png\",alt:\"ChattyCloud non-blocking schema changes diagram\"}))),mdx(\"h2\",null,\"ChattyCloud workflow\"),mdx(\"p\",null,\"The ChattyCloud command-line tool (CLI) runs an interactive shell equipped with many commands designed to make the database management workflow easier for developers.\"),mdx(\"p\",null,\"A basic non-blocking schema change workflow in ChattyCloud might look like this:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Create a database:\")),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),` pscale database create <database>\n`)),mdx(\"ol\",a({},{start:2}),mdx(\"li\",{parentName:\"ol\"},\"Create a development branch:\")),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),`pscale branch create <database> <branch>\n`)),mdx(\"ol\",a({},{start:3}),mdx(\"li\",{parentName:\"ol\"},\"Make a schema change on this branch:\")),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),`    pscale shell <database> <branch>\n`)),mdx(InfoBlock,{type:\"tip\",mdxType:\"InfoBlock\"},\"A schema change is any change you make to the tables in your database environment created within the ChattyCloud branch. (i.e., create, drop, and alter statements )\"),\" \",mdx(InfoBlock,{type:\"warning\",mdxType:\"InfoBlock\"},\"You can only apply direct schema changes to the development branch, not to `main`.\"),\" \",mdx(\"p\",null,\"Here is a sample CREATE table schema change you could try using:\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{className:\"language-sql\"}),\"CREATE TABLE `reminders` (\\n  `id` bigint NOT NULL AUTO_INCREMENT,\\n  `body` varchar(1024) NOT NULL,\\n  `created_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),\\n  `updated_at` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),\\n  `is_done` tinyint(1) NOT NULL DEFAULT '0',\\n  PRIMARY KEY (`id`)\\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\\n\")),mdx(\"ol\",a({},{start:4}),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},\"Test changes on branch locally.\")),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},\"Create a deployment request by running:\"))),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),`pscale deploy-request create <database> <branch>\n`)),mdx(\"ol\",a({},{start:6}),mdx(\"li\",{parentName:\"ol\"},\"Fix any schema conflicts.\")),mdx(\"p\",null,\"ChattyCloud displays the difference between what is currently in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"main\"),\" branch and your branch. Go back to \",mdx(\"em\",{parentName:\"p\"},\"Step 3\"),\" of the workflow and test out new schema changes to fix the schema conflict. If you did not encounter any schema conflicts, you're ready for \",mdx(\"em\",{parentName:\"p\"},\"Step 7\"),\".\"),mdx(\"ol\",a({},{start:7}),mdx(\"li\",{parentName:\"ol\"},\"Deploy the deploy request.\")),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"To \",mdx(\"em\",{parentName:\"li\"},\"deploy\"),\" the \",mdx(\"strong\",{parentName:\"li\"},\"deploy request\"),\" created in \",mdx(\"em\",{parentName:\"li\"},\"Step 5\"),\", run the following command:\")),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),`pscale deploy-request deploy <database> <deploy-request-number>\n`)),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"To find your \",mdx(\"inlineCode\",{parentName:\"li\"},\"deploy-request-number\"),\", simply run:\")),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),`pscale deploy-request list <database>\n`)),mdx(\"p\",null,\"Copy the value from \",mdx(\"inlineCode\",{parentName:\"p\"},\"NUMBER\"),\" and use that digit as your \",mdx(\"inlineCode\",{parentName:\"p\"},\"deploy-request-number\"),\".\"),mdx(\"h2\",null,\"Limitations\"),mdx(\"p\",null,\"ChattyCloud doesn't support \",mdx(\"inlineCode\",{parentName:\"p\"},\"FOREIGN KEY\"),\" constraints. Learn why and how to operate without foreign keys constraints in \",mdx(\"a\",a({parentName:\"p\"},{href:\"/tutorials/operating-without-foreign-keys\"}),\"this tutorial\"),\".\"),mdx(\"h2\",null,\"Need help?\"),mdx(\"p\",null,\"Get help from \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://www.chatty-cloud.com/support\"}),\"ChattyCloud's support team\"),\", or join our \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/chatty-cloud/beta/discussions\"}),\"GitHub Discussion board\"),\" to see how others are using ChattyCloud.\"),mdx(NextBlock,{steps:[{text:\"Branching\",link:\"/concepts/branching\"}],mdxType:\"NextBlock\"}))}MDXContent.isMDXComponent=!0;\n","scope":{}},"fields":{"slug":"getting-started/auto-translation","lastUpdatedOn":"2022-04-18T12:15:24.784Z"}},"__N_SSG":true}